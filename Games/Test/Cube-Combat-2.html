<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cube Combat 2: The Render Error</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
body {
    margin: 0;
    padding: 0;
    background-color: #050505;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: 'Courier New', Courier, monospace;
    color: white;
    overflow: hidden;
}

#game-wrapper {
    position: relative;
    width: 800px;
    height: 600px;
    box-shadow: 0 0 50px rgba(0, 255, 255, 0.1);
    background-color: #000;
    overflow: hidden;
}

canvas {
    display: block;
    background-color: #222;
}

/* --- CUTSCENE STYLES --- */
#cutscene-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 50;
    background: black;
}

#cutscene-layer.hidden {
    display: none;
    pointer-events: none;
}

#three-canvas-container {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
}

#cutscene-ui {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    z-index: 60;
    pointer-events: none;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.cinematic-bar {
    width: 100%;
    height: 60px;
    background: black;
}

#cs-dialog-box {
    background: rgba(0, 0, 0, 0.92);
    border: 2px solid #00ffff;
    border-radius: 4px;
    padding: 20px 30px;
    min-height: 70px;
    max-width: 700px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.5s ease, transform 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    margin-bottom: 80px;
    box-shadow: 0 0 30px rgba(0, 255, 255, 0.4), inset 0 0 20px rgba(0, 255, 255, 0.1);
    backdrop-filter: blur(10px);
}

#cs-dialog-text {
    font-size: 1.1rem;
    text-align: center;
    text-shadow: 0 0 10px rgba(0, 255, 255, 0.8), 0 0 20px rgba(0, 255, 255, 0.4);
    color: #ffffff;
    letter-spacing: 0.5px;
    line-height: 1.5;
    font-weight: 500;
}

#warning-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 5rem;
    font-weight: 900;
    color: #ff0033;
    text-transform: uppercase;
    text-shadow: 0 0 20px rgba(255, 0, 51, 0.8),
                 0 0 40px rgba(255, 0, 51, 0.6),
                 4px 4px 8px rgba(0, 0, 0, 0.9);
    display: none;
    z-index: 70;
    white-space: nowrap;
    letter-spacing: 8px;
}

/* Glitch Animations */
.glitch-anim {
    animation: glitch-skew 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both infinite;
    color: red;
}

@keyframes glitch-skew {
    0% { transform: translate(-50%, -50%); }
    20% { transform: translate(-55%, -45%); }
    40% { transform: translate(-55%, -55%); }
    60% { transform: translate(-45%, -45%); }
    80% { transform: translate(-45%, -55%); }
    100% { transform: translate(-50%, -50%); }
}

.screen-shake {
    animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite;
}

.cs-move-up {
    transform: translateY(-320px) scale(0.85);
    opacity: 0.3 !important;
    pointer-events: none;
}

@keyframes shake {
    10%, 90% { transform: translate3d(-4px, 0, 0); }
    20%, 80% { transform: translate3d(6px, 0, 0); }
    30%, 50%, 70% { transform: translate3d(-8px, 0, 0); }
    40%, 60% { transform: translate3d(8px, 0, 0); }
}

#scanlines {
    background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.3));
    background-size: 100% 3px;
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none;
    z-index: 55;
    animation: scanline-move 8s linear infinite;
}

@keyframes scanline-move {
    0% { transform: translateY(0); }
    100% { transform: translateY(3px); }
}

#vignette {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    box-shadow: 0 0 200px rgba(0,0,0,0.95) inset;
    background: radial-gradient(ellipse at center, transparent 30%, rgba(0, 0, 0, 0.7) 100%);
    pointer-events: none;
    z-index: 56;
}

/* --- UI LAYER & EXISTING STYLES --- */
#ui-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.menu-screen {
    background: radial-gradient(ellipse at center, rgba(10, 10, 30, 0.95) 0%, rgba(0, 0, 0, 0.98) 100%);
    pointer-events: auto;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    transition: opacity 0.5s ease;
}

.menu-screen::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: repeating-linear-gradient(
        0deg,
        rgba(0, 255, 255, 0.03) 0px,
        transparent 1px,
        transparent 2px,
        rgba(0, 255, 255, 0.03) 3px
    );
    pointer-events: none;
    animation: scan-lines 8s linear infinite;
}

@keyframes scan-lines {
    0% { transform: translateY(0); }
    100% { transform: translateY(4px); }
}

.menu-screen.hidden {
    opacity: 0;
    pointer-events: none;
    transform: scale(0.95);
}

.menu-screen.active {
    opacity: 1;
    pointer-events: auto;
    transform: scale(1);
}

.game-title {
    font-size: 60px;
    margin-bottom: 10px;
    text-shadow:
        0 0 10px #0000FF,
        0 0 20px #0000FF,
        0 0 30px #0000FF,
        4px 4px 0px rgba(0, 0, 255, 0.5);
    letter-spacing: 8px;
    text-align: center;
    animation: title-glow 3s ease-in-out infinite;
    position: relative;
    z-index: 10;
    font-weight: 900;
    background: linear-gradient(180deg, #ffffff 0%, #00ffff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

@keyframes title-glow {
    0%, 100% {
        filter: brightness(1) drop-shadow(0 0 20px #0000FF);
    }
    50% {
        filter: brightness(1.2) drop-shadow(0 0 30px #00ffff);
    }
}

.menu-buttons {
    position: relative;
    z-index: 10;
    margin-top: 20px;
}

.menu-buttons button {
    display: block;
    width: 300px;
    padding: 18px 30px;
    margin: 20px auto;
    font-size: 22px;
    border: 3px solid #00ffff;
    background: rgba(0, 20, 40, 0.6);
    color: #00ffff;
    cursor: pointer;
    font-family: inherit;
    text-transform: uppercase;
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    position: relative;
    overflow: hidden;
    letter-spacing: 2px;
    font-weight: 700;
    box-shadow:
        0 0 10px rgba(0, 255, 255, 0.3),
        inset 0 0 10px rgba(0, 255, 255, 0.1);
}

.menu-buttons button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: radial-gradient(circle, rgba(0, 255, 255, 0.4) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
    border-radius: 50%;
}

.menu-buttons button::after {
    content: 'â€º';
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%) translateX(10px);
    opacity: 0;
    transition: all 0.3s;
    font-size: 28px;
}

.btn-primary:hover, .btn-secondary:hover {
    background: rgba(0, 255, 255, 0.2);
    color: #ffffff;
    border-color: #ffffff;
    box-shadow:
        0 0 30px rgba(0, 255, 255, 0.8),
        inset 0 0 20px rgba(0, 255, 255, 0.3);
    transform: translateY(-3px) scale(1.05);
}

.btn-primary:hover::before, .btn-secondary:hover::before {
    width: 400px;
    height: 400px;
}

.btn-primary:hover::after, .btn-secondary:hover::after {
    transform: translateY(-50%) translateX(0);
    opacity: 1;
}

.btn-primary:active, .btn-secondary:active {
    transform: translateY(-1px) scale(1.02);
}

/* Audio indicator */
.audio-indicator {
    position: absolute;
    bottom: 20px;
    right: 20px;
    font-size: 14px;
    color: #00ffff;
    text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
    padding: 10px 15px;
    border: 2px solid rgba(0, 255, 255, 0.3);
    background: rgba(0, 20, 40, 0.5);
    border-radius: 4px;
    animation: pulse-glow 2s ease-in-out infinite;
    z-index: 10;
}

@keyframes pulse-glow {
    0%, 100% {
        box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
    }
    50% {
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.6);
    }
}

/* Version text */
.version-text {
    position: absolute;
    bottom: 20px;
    left: 20px;
    font-size: 12px;
    color: rgba(0, 255, 255, 0.5);
    text-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
    z-index: 10;
    font-style: italic;
}

/* Animated background particles */
.menu-particles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    pointer-events: none;
    z-index: 1;
}

.particle {
    position: absolute;
    width: 3px;
    height: 3px;
    background: #00ffff;
    border-radius: 50%;
    opacity: 0;
    animation: float-particle 15s infinite ease-in-out;
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
}

.particle:nth-child(1) { left: 10%; animation-delay: 0s; animation-duration: 12s; }
.particle:nth-child(2) { left: 20%; animation-delay: 2s; animation-duration: 15s; }
.particle:nth-child(3) { left: 30%; animation-delay: 4s; animation-duration: 13s; }
.particle:nth-child(4) { left: 40%; animation-delay: 1s; animation-duration: 14s; }
.particle:nth-child(5) { left: 50%; animation-delay: 3s; animation-duration: 16s; }
.particle:nth-child(6) { left: 60%; animation-delay: 5s; animation-duration: 11s; }
.particle:nth-child(7) { left: 70%; animation-delay: 2s; animation-duration: 13s; }
.particle:nth-child(8) { left: 80%; animation-delay: 4s; animation-duration: 15s; }
.particle:nth-child(9) { left: 90%; animation-delay: 1s; animation-duration: 12s; }
.particle:nth-child(10) { left: 15%; animation-delay: 6s; animation-duration: 14s; }

@keyframes float-particle {
    0% {
        transform: translateY(600px) translateX(0) scale(0);
        opacity: 0;
    }
    10% {
        opacity: 0.6;
    }
    90% {
        opacity: 0.6;
    }
    100% {
        transform: translateY(-100px) translateX(50px) scale(1.5);
        opacity: 0;
    }
}

/* Blink animation for dialogue prompt */
@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
}

/* 2D Dialogue Box */
#dialogue-box {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 700px;
    height: 150px;
    background: rgba(0, 10, 30, 0.95);
    border: 2px solid #0000FF;
    border-radius: 4px;
    padding: 20px;
    box-sizing: border-box;
    pointer-events: auto;
    display: flex;
    flex-direction: column;
}
#dialogue-box.hidden { display: none; }
#speaker-name { font-size: 20px; color: #00ffff; margin-bottom: 10px; font-weight: bold; text-shadow: 0 0 5px #00ffff; }
#dialogue-text { font-size: 16px; line-height: 1.4; flex-grow: 1; }
.dialogue-prompt { font-size: 12px; color: #888; text-align: right; width: 100%; animation: blink 1s infinite; }

/* HUD */
#combat-hud { position: absolute; top: 20px; left: 20px; width: calc(100% - 40px); display: flex; justify-content: space-between; pointer-events: none; }
#combat-hud.hidden { display: none; }
.health-bar-container { width: 300px; }
.bar-label { margin-bottom: 5px; font-weight: bold; text-shadow: 1px 1px 2px black; font-size: 14px; }
.health-bar { height: 15px; background-color: #333; border: 1px solid white; width: 100%; transition: width 0.2s; }
.fill-blue { background-color: #0000FF; box-shadow: 0 0 5px #0000FF; }
.fill-red { background-color: #FF0000; box-shadow: 0 0 5px #FF0000; }
    </style>
<style type="text/css">:root img[width="728"][height="90"], :root [href="https://adstub.net/cina777/"], :root [href="https://adstub.net/arab777/"], :root [href="https://adstub.net/ratu89/"], :root [href="https://adstub.net/judi89/"], :root [href^="//mage98rquewz.com/"], :root [href^="//x4pollyxxpush.com/"], :root span[id^="ezoic-pub-ad-placeholder-"], :root ins.adsbygoogle[data-ad-slot], :root ins.adsbygoogle[data-ad-client], :root img[src^="https://s-img.adskeeper.com/"], :root guj-ad, :root gpt-ad, :root div[id^="zergnet-widget"], :root div[id^="vuukle-ad-"], :root div[id^="taboola-stream-"], :root div[id^="sticky_ad_"], :root div[id^="st"][style^="z-index: 999999999;"], :root div[id^="gpt_ad_"], :root div[id^="ezoic-pub-ad-"], :root div[id^="dfp-ad-"], :root div[id^="crt-"][style], :root div[id^="apn_native_ad_slot_"], :root div[id^="adspot-"], :root div[id^="adrotate_widgets-"], :root ps-connatix-module, :root div[id^="ad_position_"], :root div[id^="ad-div-"], :root div[id*="ScriptRoot"], :root div[id*="MarketGid"], :root [href="https://adstub.net/rusia777/"], :root div[data-id-advertdfpconf], :root div[data-dfp-id], :root hl-adsense, :root div[data-contentexchange-widget], :root div[data-alias="300x250 Ad 2"], :root div[data-adzone], :root div[data-adunit-path], :root div[data-adname], :root div[data-ad-targeting], :root div[data-ad-region], :root div[data-ad-placeholder], :root div[aria-label="Ads"], :root display-ads, :root display-ad-component, :root atf-ad-slot, :root aside[id^="adrotate_widgets-"], :root amp-fx-flying-carpet, :root amp-embed[type="taboola"], :root amp-connatix-player, :root amp-ad-custom, :root amp-ad, :root div[id^="google_dfp_"], :root ad-slot, :root ad-shield-ads, :root a[style="width:100%;height:100%;z-index:10000000000000000;position:absolute;top:0;left:0;"], :root a[onmousedown^="this.href='https://paid.outbrain.com/network/redir?"] + .ob_source, :root a[onclick^="window.location.replace('https://random-affiliate.atimaze.com/"], :root a[href^="https://xbet-4.com/"], :root div[id^="ad-position-"], :root a[href^="https://www.toprevenuegate.com/"], :root a[href^="https://www.purevpn.com/"][href*="&utm_source=aff-"], :root a[href^="https://www.privateinternetaccess.com/"] > img, :root a[href^="https://financeads.net/tc.php?"], :root a[href^="https://www.mrskin.com/tour"], :root a[href^="https://www.infowarsstore.com/"] > img, :root a[href^="https://www.highperformancecpmgate.com/"], :root a[href^="https://www.highcpmrevenuenetwork.com/"], :root a[href^="https://www.get-express-vpn.com/offer/"], :root a[href^="https://lnkxt.bannerator.com/"], :root a[href^="https://www.geekbuying.com/dynamic-ads/"], :root a[href^="https://www.financeads.net/tc.php?"], :root a[href^="https://www.effectiveratecpm.com/"], :root [href^="https://www.herbanomic.com/"] > img, :root a[href^="https://maymooth-stopic.com/"], :root a[href^="https://www.dql2clk.com/"], :root a[href^="https://www.nutaku.net/signup/landing/"], :root a[href^="https://www.dating-finder.com/signup/?ai_d="], :root a[href^="https://explore-site.com/"], :root a[href^="https://www.brazzersnetwork.com/landing/"], :root [data-template-type="nativead"], :root a[href^="https://www.endorico.com/Smartlink/"], :root a[href^="https://www.adultempire.com/"][href*="?partner_id="], :root a[href^="https://voluum.prom-xcams.com/"], :root a[href^="https://twinrdsyte.com/"], :root a[href^="https://twinrdsrv.com/"], :root a[href^="https://trk.nfl-online-streams.club/"], :root a[href^="https://tracking.avapartner.com/"], :root a[href^="https://track.wg-aff.com"], :root a[href^="https://track.ultravpn.com/"], :root a[href^="https://track.afcpatrk.com/"], :root a[href^="https://torguard.net/aff.php"] > img, :root [data-identity="adhesive-ad"], :root a[href^="https://tc.tradetracker.net/"] > img, :root a[href^="https://tatrck.com/"], :root a[href^="https://click.candyoffers.com/"], :root [href^="https://zstacklife.com/"] img, :root a[href^="https://t.aslnk.link/"], :root a[href^="https://t.adating.link/"], :root a[href^="https://go.trackitalltheway.com/"], :root [href^="https://track.fiverr.com/visit/"] > img, :root a[href^="https://syndication.exoclick.com/"], :root a[href^="https://syndication.dynsrvtbg.com/"], :root div[data-alias="300x250 Ad 1"], :root a[href^="https://syndicate.contentsserved.com/"], :root a[href^="https://svb-analytics.trackerrr.com/"], :root a[href^="https://track.aftrk5.com/"], :root a[href^="https://slkmis.com/"], :root a[href^="https://myclick-2.com/"], :root a[href^="https://sexynearme.com/"], :root [data-ad-manager-id], :root a[href^="https://s.zlinkr.com/"], :root bottomadblock, :root a[href^="https://s.zlinkd.com/"], :root [href="https://adstub.net/gaza88/"], :root a[href^="https://ad.doubleclick.net/"], :root a[href^="https://static.fleshlight.com/images/banners/"], :root a[href^="https://s.zlink7.com/"], :root a[href^="https://s.zlink3.com/"], :root a[href^="https://www.mrskin.com/account/"], :root a[href^="https://s.optzsrv.com/"], :root a[href^="https://s.ma3ion.com/"], :root a[href^="https://s.eunow4u.com/"], :root #kt_player > div[style$="display: block;"][style*="inset: 0px;"], :root [href$="/sexdating.php"], :root a[href^="https://quotationfirearmrevision.com/"], :root a[href^="https://pubads.g.doubleclick.net/"], :root a[href^="https://prf.hn/click/"][href*="/camref:"] > img, :root a[href^="https://www.dating-finder.com/?ai_d="], :root a[href^="https://serve.awmdelivery.com/"], :root a[href^="https://prf.hn/click/"][href*="/adref:"] > img, :root app-ad, :root [href^="https://ap.octopuspop.com/click/"] > img, :root a[href^="https://postback1win.com/"], :root a[href^="https://mmwebhandler.aff-online.com/"], :root a[href^="https://www.bet365.com/"][href*="affiliate="], :root a[href^="https://pb-track.com/"], :root a[href^="https://pb-front.com/"], :root a[href^="https://paid.outbrain.com/network/redir?"], :root a[href^="https://streamate.com/landing/click/"], :root div[class^="Adstyled__AdWrapper-"], :root a[href^="https://osfultrbriolenai.info/"], :root a[href^="https://upsups.click/"], :root a[href^="https://ndt5.net/"], :root a[href^="https://natour.naughtyamerica.com/track/"], :root a[href^="https://mediaserver.entainpartners.com/renderBanner.do?"], :root a[href^="https://lead1.pl/"], :root a[href^="https://landing.brazzersnetwork.com/"], :root a[href^="https://join.virtuallust3d.com/"], :root a[href^="https://kiksajex.com/"], :root a[href^="https://juicyads.in/"], :root a[href^="https://snowdayonline.xyz/"], :root a[href^="https://mediaserver.gvcaffiliates.com/renderBanner.do?"], :root a[href^="https://join.dreamsexworld.com/"], :root a[href^="https://join.bannedsextapes.com/track/"], :root a[href^="https://jaxofuna.com/"], :root a[href^="https://italarizege.xyz/"], :root a[href^="https://iqbroker.com/"][href*="?aff="], :root a[href^="https://identicaldrench.com/"], :root a[href^="https://hot-growngames.life/"], :root a[href^="https://helmethomicidal.com/"], :root a[href^="https://golinks.work/"], :root a[href^="https://s.zlinkn.com/"], :root a[href^="https://go.xxxvjmp.com/"], :root a[href^="https://go.xxxjmp.com"], :root [class^="tile-picker__CitrusBannerContainer-sc-"], :root a[href^="https://go.xxxiijmp.com"], :root a[href^="https://go.xtbaffiliates.com/"], :root [data-role="tile-ads-module"], :root a[href^="https://go.xlviirdr.com"], :root div[class$="-adlabel"], :root a[href^="https://go.xlviiirdr.com"], :root a[href^="https://ismlks.com/"], :root [href^="https://www.mypillow.com/"] > img, :root a[href^="https://go.xlirdr.com"], :root [data-css-class="dfp-inarticle"], :root a[href^="https://l.hyenadata.com/"], :root a[href^="https://go.tmrjmp.com"], :root a[href^="https://zirdough.net/"], :root a[href^="https://s.deltraff.com/"], :root a[href^="https://go.markets.com/visit/?bta="], :root a[href^="https://billing.purevpn.com/aff.php"] > img, :root a[href^="https://go.hpyrdr.com/"], :root a[href^="https://lijavaxa.com/"], :root a[href^="https://go.goaserv.com/"], :root a[href^="https://t.hrtye.com/"], :root a[href^="https://go.etoro.com/"] > img, :root a[href^="https://go.dmzjmp.com"], :root a[href^="https://www.bang.com/?aff="], :root #mgb-container > #mgb, :root a[href^="https://go.admjmp.com"], :root a[href^="https://ak.stikroltiltoowi.net/"], :root a[href^="https://get.surfshark.net/aff_c?"][href*="&aff_id="] > img, :root a[href^="https://www.adskeeper.com"], :root a[data-redirect^="https://paid.outbrain.com/network/redir?"], :root [href^="https://clicks.affstrack.com/"] > img, :root a[href^="https://engine.phn.doublepimp.com/"], :root a[href^="https://engine.blueistheneworanges.com/"], :root a[href^="https://drumskilxoa.click/"], :root a[href^="https://dl-protect.net/"], :root a[href*=".foxqck.com/"], :root a[href^="https://ctosrd.com/"], :root a[href^="https://clixtrac.com/"], :root [href^="https://noqreport.com/"] > img, :root a[href^="https://clicks.pipaffiliates.com/"], :root app-advertisement, :root a[href^="https://getmatchedlocally.com/"], :root a[href^="https://clickins.slixa.com/"], :root a[href^="https://datewhisper.life/"], :root a[href^="https://get-link.xyz/"], :root a[href^="https://click.linksynergy.com/fs-bin/"] > img, :root a[href^="https://combodef.com/"], :root a[href^="https://click.hoolig.app/"], :root a[href^="https://www.onlineusershielder.com/"], :root a[href^="https://click.ggpickaff.com/"], :root a[href^="https://track.totalav.com/"], :root a[href^="https://ctrdwm.com/"], :root img[src^="https://images.purevpnaffiliates.com"], :root a[href^="https://porntubemate.com/"], :root a[href^="https://clickadilla.com/"], :root a[href^="https://click.dtiserv2.com/"], :root a[href^="https://www.adxsrve.com/"], :root a[href^="https://click.Ggpickaff.com/"], :root a[href^="https://go.xlvirdr.com"], :root a[href^="http://www.iyalc.com/"], :root a[href^="https://stardomcoit.com/"], :root a[href^="https://claring-loccelkin.com/"], :root a[href^="https://bongacams2.com/track?"], :root a[href^="https://t.ajrkm1.com/"], :root a[href^="https://bongacams10.com/track?"], :root a[href^="https://www.sheetmusicplus.com/"][href*="?aff_id="], :root a[href^="https://bngpt.com/"], :root a[href^="//hoodingluster.com/"], :root a[href^="https://black77854.com/"], :root a[href^="http://annulmentequitycereals.com/"], :root [data-taboola-options], :root a[href^="https://believessway.com/"], :root a[href^="https://Click.ggpickaff.com/"], :root a[href^="https://banners.livepartners.com/"], :root a[href^="http://revolvemockerycopper.com/"], :root a[href^="https://awptjmp.com/"], :root a[href^="https://join.sexworld3d.com/track/"], :root a[href^="https://aweptjmp.com/"], :root a[href^="https://ausoafab.net/"], :root a[href^="https://aj1070.online/"], :root a[href^="https://bc.game/"], :root a[href^="https://ak.oalsauwy.net/"], :root a[href^="https://a.bestcontentoperation.top/"], :root a[href^="https://adultfriendfinder.com/go/"], :root a[href^="https://ads.planetwin365affiliate.com/"], :root a[href^="https://ads.leovegas.com/"], :root .nya-slot[style], :root a[href^="https://a.bestcontentweb.top/"], :root a[href^="https://a2.adform.net/"], :root a[href^="https://a.candyai.love/"], :root a[href^="https://playnano.online/offerwalls/?ref="], :root a[href^="https://a.adtng.com/"], :root .banner-img > .pbl, :root [data-m-ad-id], :root a[href^="https://a-ads.com/"], :root [id^="ad_slider"], :root a[href^="https://click.ggpickyaff.com/"], :root broadstreet-zone-container, :root a[href^="https://ak.psaltauw.net/"], :root a[href^="https://1winpb.com/"], :root div[id^="rc-widget-"], :root a[href^="https://turnstileunavailablesite.com/"], :root a[href^="https://chaturbate.com/in/?"], :root a[href^="https://prf.hn/click/"][href*="/creativeref:"] > img, :root a[href*="&maxads="], :root a[href^="http://www.adultempire.com/unlimited/promo?"][href*="&partner_id="], :root a[href^="https://1betandgonow.com/"], :root div[id^="optidigital-adslot"], :root [href^="https://wsup.ai/"], :root a[href^="https://123-stream.org/"], :root a[href^="https://in.rabbtrk.com/"], :root a[href^="http://www.h4trck.com/"], :root a[href^="http://www.friendlyduck.com/AF_"], :root a[href^="http://partners.etoro.com/"], :root [href="https://chaturbate.jjgirls.com/"] > img, :root a[href^="http://cam4com.go2cloud.org/aff_c?"], :root a[href^="https://ads.betfair.com/redirect.aspx?"], :root a[href^="http://trk.globwo.online/"], :root a[href^="http://troopsassistedstupidity.com/"], :root a[href^="https://random-affiliate.atimaze.com/"], :root a-ad, :root a[href^="https://offhandpump.com/"], :root a[href^="http://stickingrepute.com/"], :root #slashboxes > .deals-rail, :root a[href^="http://join.brokestraightboys.com/track/"], :root a[href^="http://roadcontagion.com/"], :root a[href^="http://premonitioninventdisagree.com/"], :root [href^="http://mypillow.com/"] > img, :root a[href^="http://bongacams.com/track?"], :root a[href^="https://track.adform.net/"], :root a[href^="http://avthelkp.net/"], :root a[href^="https://a.medfoodhome.com/"], :root a[href^="https://engine.flixtrial.com/"], :root [data-type="ad-vertical"], :root a[href^="//startgaming.net/tienda/" i], :root a[href^="https://a.medfoodsafety.com/"], :root a[href^="//go.eabids.com/"], :root a[href^="//ejitsirdosha.net/"], :root a[href^=" https://www.friendlyduck.com/AF_"], :root [data-cl-spot-id], :root a[href*="/jump/next.php?r="], :root a[href^="https://go.rmishe.com/"], :root [href^="https://ilovemyfreedoms.com/landing-"], :root a[href^="https://syndication.optimizesrv.com/"], :root a[href*="//daichoho.com/"], :root a[href^="https://go.nordvpn.net/aff"] > img, :root .\[\&_\.gdprAdTransparencyCogWheelButton\]\:\!pjra-z-\[5\], :root [href^="http://clicks.totemcash.com/"], :root a[href^="https://ad.zanox.com/ppc/"] > img, :root a[href^="https://lone-pack.com/"], :root [data-d-ad-id], :root a[href*=".engine.adglare.net/"], :root a[href^="https://t.ajrkm3.com/"], :root [href^="https://aads.com/campaigns/"], :root a[href^="//stighoazon.com/"], :root div[id^="lazyad-"], :root a[href^="http://com-1.pro/"], :root [href^="https://www.profitablegatecpm.com/"], :root a[href*=".cfm?domain="][href*="&fp="], :root [data-ad-name], :root a[href^="https://loboclick.com/"], :root a[data-url^="https://vulpix.bet/?ref="], :root a[href^="https://ab.advertiserurl.com/aff/"], :root a[data-oburl^="https://paid.outbrain.com/network/redir?"], :root a[href^="https://go.xlivrdr.com"], :root [onclick^="location.href='https://1337x.vpnonly.site/"], :root [id^="section-ad-banner"], :root a[href^="https://www.goldenfrog.com/vyprvpn?offer_id="][href*="&aff_id="], :root a[href^="https://wmctjd.com/"], :root a[href*="//jjgirls.com/sex/Chaturbate"], :root [id^="ad-wrap-"], :root [href^="https://zone.gotrackier.com/"], :root a[href^="http://sarcasmadvisor.com/"], :root [href^="https://www.restoro.com/"], :root [href^="https://www.targetingpartner.com/"], :root .section-subheader > .section-hotel-prices-header, :root [href^="https://www.hostg.xyz/"] > img, :root a[href^="http://adultfriendfinder.com/go/"], :root a[href^="https://fastestvpn.com/lifetime-special-deal?a_aid="], :root a[href^="https://tour.mrskin.com/"], :root [href^="https://www.brighteonstore.com/products/"] img, :root citrus-ad-wrapper, :root a[href^="https://go.grinsbest.com/"], :root a[href^="https://vo2.qrlsx.com/"], :root [href^="https://www.avantlink.com/click.php"] img, :root [href^="https://wwp.hoqodd.com/redirect-zone/"], :root div[id^="div-ads-"], :root [href^="https://rapidgator.net/article/premium/ref/"], :root [href^="https://join.girlsoutwest.com/"], :root a[href^="https://activate-game.com/"], :root .scroll-fixable.rail-right > .deals-rail, :root [data-wpas-zoneid], :root a[href^="https://track.aftrk3.com/"], :root [href^="https://join3.bannedsextapes.com"], :root a[href^="https://bodelen.com/"], :root a[href*=".g2afse.com/"], :root div[id^="adngin-"], :root [data-rc-widget], :root span[data-ez-ph-id], :root [href^="https://track.aftrk1.com/"], :root [href^="https://join.playboyplus.com/track/"], :root a[href^="https://go.xxxijmp.com"], :root [href^="https://istlnkcl.com/"], :root a[href^="https://t.acam.link/"], :root a[href^="https://go.strpjmp.com/"], :root [href^="https://url.totaladblock.com/"], :root a[href^="https://tm-offers.gamingadult.com/"], :root [href^="https://charmingdatings.life/"], :root [href="https://adstub.net/indo666/"], :root [href^="https://glersakr.com/"], :root a[href^="https://a.bestcontentfood.top/"], :root [href^="https://cpa.10kfreesilver.com/"], :root [data-id^="div-gpt-ad"], :root a[href^="https://tracker.loropartners.com/"], :root [href^="https://awbbjmp.com/"], :root div[ow-ad-unit-wrapper], :root a[data-href^="http://ads.trafficjunky.net/"], :root [data-advadstrackid], :root a[href^="https://www.friendlyduck.com/AF_"], :root [href^="https://ad1.adfarm1.adition.com/"], :root a[href^="https://bngprm.com/"], :root [href^="https://shiftnetwork.infusionsoft.com/go/"] > img, :root a[href^="https://go.bushheel.com/"], :root a[href^="https://ctjdwm.com/"], :root a[href^="https://camfapr.com/landing/click/"], :root div[data-ad-wrapper], :root .gnt_em_vp_c[data-g-s="vp_dk"], :root [href="//sexcams.plus/"], :root [href^="http://www.mypillow.com/"] > img, :root a[href^="https://promerycergerful.com/"], :root #kt_player > a[target="_blank"], :root [href="https://ourgoldguy.com/contact/"] img, :root .ob_container .item-container-obpd, :root [id^="div-gpt-ad"], :root [href="https://jdrucker.com/gold"] > img, :root a[href^="https://join.virtualtaboo.com/track/"], :root [id^="ad_sky"], :root [name^="google_ads_iframe"], :root a[href^="https://www.liquidfire.mobi/"], :root .grid > .container > #aside-promotion, :root DFP-AD, :root [href^="https://go.xlrdr.com"], :root a[href^="https://s.cant3am.com/"], :root [data-testid^="taboola-"], :root [data-testid^="section-AdRowBillboard"], :root a[href^="https://track.1234sd123.com/"], :root zeus-ad, :root [data-testid="prism-ad-wrapper"], :root [href^="https://ad.admitad.com/"], :root [href^="https://mypillow.com/"] > img, :root [data-testid="ad_testID"], :root a[href^="https://trk.softonixs.xyz/"], :root [href^="https://www.mypatriotsupply.com/"] > img, :root [href^="https://antiagingbed.com/discount/"] > img, :root a[href*=".adsrv.eacdn.com/"], :root a[href^="https://go.cmtaffiliates.com/"], :root [href^="https://optimizedelite.com/"] > img, :root [data-testid="adBanner-wrapper"], :root [href^="https://mylead.global/stl/"] > img, :root [href^="https://mypatriotsupply.com/"] > img, :root a[href^="https://go.hpyjmp.com"], :root iframe[scrolling="no"][sandbox*="allow-popups allow-modals"][style^="width: 100%; height: 100%; border: none;"], :root [href^="https://mystore.com/"] > img, :root [href^="https://wct.link/click?"], :root div[data-adunit], :root app-large-ad, :root [href^="https://turtlebids.irauctions.com/"] img, :root a[href^="https://witnessjacket.com/"], :root [data-mobile-ad-id], :root [data-dynamic-ads], :root [class^="amp-ad-"], :root a[href^="http://handgripvegetationhols.com/"], :root a[href^="https://go.rmhfrtnd.com"], :root a[href^="https://go.bbrdbr.com"], :root a[href^="https://fc.lc/ref/"], :root [data-adshim], :root topadblock, :root a[href^="//s.zlinkd.com/"], :root #teaser1[style^="width:autopx;"], :root [href^="https://www.cloudways.com/en/?id"], :root [data-asg-ins], :root a[href^="https://gamingadlt.com/?offer="], :root a[href^="https://rixofa.com/"], :root a[href^="https://best-experience-cool.com/"], :root [data-desktop-ad-id], :root [data-adbridg-ad-class], :root #teaser3[style^="width:autopx;"], :root [data-adblockkey], :root [data-block-type="ad"], :root [data-ad-width], :root [onclick*="content.ad/"], :root AMP-AD, :root [data-ad-cls], :root [data-ez-name], :root a[href^="https://go.mnaspm.com/"], :root a[href^="https://service.bv-aff-trx.com/"], :root a[href^="https://6-partner.com/"], :root [class^="s2nPlayer"], :root [href^="https://affiliate.fastcomet.com/"] > img, :root [class^="adDisplay-module"], :root a[href^="https://adclick.g.doubleclick.net/"], :root [data-freestar-ad][id], :root AD-SLOT, :root a[href^="https://www.googleadservices.com/pagead/aclk?"] > img, :root [data-ad-module], :root a[href^="https://go.skinstrip.net"][href*="?campaignId="], :root #teaser2[style^="width:autopx;"], :root [data-revive-zoneid], :root a[href^="https://losingoldfry.com/"], :root div[id^="div-gpt-"], :root a[href^="https://gml-grp.com/"], :root .ob_dual_right > .ob_ads_header ~ .odb_div, :root a[href^="http://tc.tradetracker.net/"] > img, :root [data-testid="commercial-label-taboola"], :root [class^="div-gpt-ad"], :root a[href^="https://traffdaq.com/"], :root a[href^="https://cam4com.go2cloud.org/"], :root a[href^="http://li.blogtrottr.com/click?"], :root a[href^="https://www8.smartadserver.com/"], :root a[href^="https://pb-imc.com/"], :root a[onmousedown^="this.href='https://paid.outbrain.com/network/redir?"], :root a[href^="https://t.ajump1.com/"], :root a[href^="https://wittered-mainging.com/"], :root #teaser3[style="width: 100%;text-align: center;display: scroll;position:fixed;bottom: 0;margin: 0 auto;z-index: 103;"] { display: none !important; }</style></head>
<body>
    <div id="game-wrapper">
        <canvas id="gameCanvas" width="800" height="600"></canvas>

        <div id="cutscene-layer" class="hidden">
            <div id="cutscene-ui">
                <div class="cinematic-bar"></div>
                <div id="warning-overlay">RENDER ERROR</div>
                <div id="cs-dialog-box">
                    <div id="cs-dialog-text"></div>
                </div>
                <div class="cinematic-bar"></div>
            </div>
            <div id="scanlines"></div>
            <div id="vignette"></div>
            <div id="three-canvas-container"></div>
        </div>

        <div id="ui-layer">
            <div id="main-menu" class="menu-screen active">
                <div class="menu-particles">
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                </div>
                <h1 class="game-title">CUBE COMBAT 2</h1>
                <h3 style="color: #00ffff; margin-top: 0; margin-bottom: 40px; text-shadow: 0 0 10px rgba(0, 255, 255, 0.8); letter-spacing: 4px; position: relative; z-index: 10; font-weight: 500; font-size: 20px;">SECTOR ZERO EDITION</h3>
                <div class="menu-buttons">
                    <button class="btn btn-primary" onclick="startCampaignFlow()">â–¶ START CAMPAIGN</button>
                    <button class="btn btn-secondary" onclick="showCredits()">â„¹ CREDITS</button>
                </div>
                <div class="audio-indicator">
                    ðŸ”Š AUDIO: ON
                </div>
                <div class="version-text">
                    v1.0 â€¢ Enhanced Edition
                </div>
            </div>

            <div id="dialogue-box" class="hidden">
                <div id="speaker-name">Blue Cube</div>
                <div id="dialogue-text">...</div>
                <div class="dialogue-prompt">Press [SPACE] to continue</div>
            </div>

            <div id="combat-hud" class="hidden">
                <div class="health-bar-container p1">
                    <div class="bar-label">BLUE CUBE</div>
                    <div id="p1-health" class="health-bar fill-blue"></div>
                </div>
                <div class="health-bar-container p2">
                    <div class="bar-label" id="enemy-name">ENEMY</div>
                    <div id="p2-health" class="health-bar fill-red"></div>
                </div>
            </div>
        </div>
    </div>
    <script>
// --- AUDIO SYSTEM ---
const AudioSystem = {
    ctx: null,
    masterGain: null,
    musicGain: null,
    sfxGain: null,
    currentMusic: null,

    init: function() {
        this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        this.masterGain = this.ctx.createGain();
        this.masterGain.gain.value = 0.6;
        this.masterGain.connect(this.ctx.destination);

        this.musicGain = this.ctx.createGain();
        this.musicGain.gain.value = 0.3;
        this.musicGain.connect(this.masterGain);

        this.sfxGain = this.ctx.createGain();
        this.sfxGain.gain.value = 0.4;
        this.sfxGain.connect(this.masterGain);
    },

    playSFX: function(type) {
        if (!this.ctx) return;

        const now = this.ctx.currentTime;
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();

        osc.connect(gain);
        gain.connect(this.sfxGain);

        switch(type) {
            case 'alert':
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(400, now + 0.1);
                osc.frequency.exponentialRampToValueAtTime(800, now + 0.2);
                gain.gain.setValueAtTime(0.5, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
                break;

            case 'damage':
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.exponentialRampToValueAtTime(50, now + 0.3);
                gain.gain.setValueAtTime(0.6, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
                break;

            case 'explosion':
                const noise = this.ctx.createBufferSource();
                const buffer = this.ctx.createBuffer(1, this.ctx.sampleRate * 0.5, this.ctx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < buffer.length; i++) {
                    data[i] = Math.random() * 2 - 1;
                }
                noise.buffer = buffer;
                const noiseFilter = this.ctx.createBiquadFilter();
                noiseFilter.type = 'lowpass';
                noiseFilter.frequency.setValueAtTime(800, now);
                noiseFilter.frequency.exponentialRampToValueAtTime(50, now + 0.5);
                noise.connect(noiseFilter);
                noiseFilter.connect(gain);
                gain.gain.setValueAtTime(0.8, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                noise.start(now);
                noise.stop(now + 0.5);
                break;

            case 'glitch':
                osc.type = 'square';
                osc.frequency.setValueAtTime(Math.random() * 500 + 200, now);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
                break;

            case 'whoosh':
                osc.type = 'sine';
                osc.frequency.setValueAtTime(100, now);
                osc.frequency.exponentialRampToValueAtTime(1000, now + 0.3);
                gain.gain.setValueAtTime(0.4, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
                break;

            case 'tension':
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(100, now);
                osc.frequency.linearRampToValueAtTime(120, now + 2);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.linearRampToValueAtTime(0.5, now + 2);
                osc.start(now);
                osc.stop(now + 2);
                break;
        }
    },

    startMusic: function(mood = 'ambient') {
        if (!this.ctx) return;
        this.stopMusic();

        const now = this.ctx.currentTime;

        if (mood === 'ambient') {
            const bass = this.ctx.createOscillator();
            bass.type = 'sine';
            bass.frequency.value = 55;

            const mid = this.ctx.createOscillator();
            mid.type = 'triangle';
            mid.frequency.value = 110;

            const pad = this.ctx.createOscillator();
            pad.type = 'sine';
            pad.frequency.value = 220;

            const bassGain = this.ctx.createGain();
            const midGain = this.ctx.createGain();
            const padGain = this.ctx.createGain();

            bassGain.gain.value = 0.2;
            midGain.gain.value = 0.1;
            padGain.gain.value = 0.05;

            bass.connect(bassGain).connect(this.musicGain);
            mid.connect(midGain).connect(this.musicGain);
            pad.connect(padGain).connect(this.musicGain);

            bass.start(now);
            mid.start(now);
            pad.start(now);

            this.currentMusic = [bass, mid, pad];

        } else if (mood === 'danger') {
            const bass = this.ctx.createOscillator();
            bass.type = 'sawtooth';
            bass.frequency.value = 65;

            const pulse = this.ctx.createOscillator();
            pulse.type = 'square';
            pulse.frequency.value = 130;

            const bassGain = this.ctx.createGain();
            const pulseGain = this.ctx.createGain();

            bassGain.gain.value = 0.25;
            pulseGain.gain.value = 0.1;

            const lfo = this.ctx.createOscillator();
            lfo.frequency.value = 2;
            const lfoGain = this.ctx.createGain();
            lfoGain.gain.value = 0.05;
            lfo.connect(lfoGain).connect(pulseGain.gain);

            bass.connect(bassGain).connect(this.musicGain);
            pulse.connect(pulseGain).connect(this.musicGain);

            bass.start(now);
            pulse.start(now);
            lfo.start(now);

            this.currentMusic = [bass, pulse, lfo];
        }
    },

    stopMusic: function() {
        if (this.currentMusic) {
            const now = this.ctx.currentTime;
            this.currentMusic.forEach(osc => {
                try {
                    osc.stop(now + 0.5);
                } catch(e) {}
            });
            this.currentMusic = null;
        }
    },

    fadeMusic: function(targetVolume, duration = 1) {
        if (!this.musicGain) return;
        const now = this.ctx.currentTime;
        this.musicGain.gain.linearRampToValueAtTime(targetVolume, now + duration);
    }
};

// --- 3D CUTSCENE SYSTEM ---
const Cutscene3D = {
    active: false,
    scene: null, camera: null, renderer: null, clock: null,
    animationId: null,
    azure: null, greenCube: null, yellowCube: null, tesseract: null, groundGrid: null,
    particles: [],
    isGlitching: false,
    width: 800,
    height: 600,

    init: function() {
        const container = document.getElementById('three-canvas-container');
        container.innerHTML = '';

        this.scene = new THREE.Scene();
        this.scene.background = new THREE.Color(0x1a1a2e);
        this.scene.fog = new THREE.FogExp2(0x1a1a2e, 0.02);

        this.camera = new THREE.PerspectiveCamera(75, this.width / this.height, 0.1, 1000);
        this.camera.position.set(0, 5, 10);
        this.camera.lookAt(0, 0, 0);

        this.renderer = new THREE.WebGLRenderer({ antialias: true });
        this.renderer.setSize(this.width, this.height);
        this.renderer.shadowMap.enabled = true;
        container.appendChild(this.renderer.domElement);

        const ambientLight = new THREE.AmbientLight(0x202040, 1.5);
        this.scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
        dirLight.position.set(5, 10, 7);
        dirLight.castShadow = true;
        dirLight.shadow.mapSize.width = 1024;
        dirLight.shadow.mapSize.height = 1024;
        this.scene.add(dirLight);

        const rimLight = new THREE.DirectionalLight(0x00ffff, 0.8);
        rimLight.position.set(-5, 3, -5);
        this.scene.add(rimLight);

        this.ambientLight = ambientLight;
        this.dirLight = dirLight;
        this.rimLight = rimLight;

        this.particles = [];
        this.isGlitching = false;
        this.clock = new THREE.Clock();

        this.createWorld();
        this.createCharacters();
        this.animate();
    },

    createWorld: function() {
        const gridHelper = new THREE.GridHelper(100, 100, 0x00ffff, 0x333333);
        this.scene.add(gridHelper);
        this.groundGrid = gridHelper;

        const geometry = new THREE.PlaneGeometry(100, 100);
        const material = new THREE.MeshPhongMaterial({
            color: 0x0a0a0a, side: THREE.DoubleSide, transparent: true, opacity: 0.8
        });
        const plane = new THREE.Mesh(geometry, material);
        plane.rotation.x = -Math.PI / 2;
        plane.position.y = -0.1;
        plane.receiveShadow = true;
        this.scene.add(plane);
    },

    createCharacters: function() {
        const geometry = new THREE.BoxGeometry(1, 1, 1);
        const azMat = new THREE.MeshStandardMaterial({
            color: 0x00ffff,
            emissive: 0x0066ff,
            emissiveIntensity: 0.7,
            roughness: 0.15,
            metalness: 0.9
        });
        this.azure = new THREE.Mesh(geometry, azMat);
        this.azure.position.set(0, 0.5, 0);
        this.azure.castShadow = true;
        this.azure.receiveShadow = true;
        this.scene.add(this.azure);

        const greenMat = new THREE.MeshStandardMaterial({
            color: 0x00ff00,
            emissive: 0x004400,
            emissiveIntensity: 0.4,
            roughness: 0.3,
            metalness: 0.7
        });
        this.greenCube = new THREE.Mesh(geometry, greenMat);
        this.greenCube.position.set(-2, 0.5, -1);
        this.greenCube.castShadow = true;
        this.scene.add(this.greenCube);

        const yellowMat = new THREE.MeshStandardMaterial({
            color: 0xffff00,
            emissive: 0x444400,
            emissiveIntensity: 0.4,
            roughness: 0.3,
            metalness: 0.7
        });
        this.yellowCube = new THREE.Mesh(geometry, yellowMat);
        this.yellowCube.position.set(2, 0.5, -1);
        this.yellowCube.castShadow = true;
        this.scene.add(this.yellowCube);
    },

    createTesseract: function() {
        const outerGeometry = new THREE.BoxGeometry(3, 3, 3);
        const outerMaterial = new THREE.MeshBasicMaterial({
            color: 0xff0033,
            wireframe: true,
            transparent: true,
            opacity: 0.9
        });
        const outerCube = new THREE.Mesh(outerGeometry, outerMaterial);

        const coreMaterial = new THREE.MeshStandardMaterial({
            color: 0x880011,
            emissive: 0xff0033,
            emissiveIntensity: 1.2,
            roughness: 0.1,
            metalness: 0.9
        });
        const core = new THREE.Mesh(new THREE.BoxGeometry(1.5, 1.5, 1.5), coreMaterial);

        this.tesseract = new THREE.Group();
        this.tesseract.add(outerCube);
        this.tesseract.add(core);
        this.tesseract.position.set(0, 20, -10);

        const tesseractLight = new THREE.PointLight(0xff0033, 3, 15);
        this.tesseract.add(tesseractLight);

        this.scene.add(this.tesseract);
    },

    createDeResParticles: function(position, color) {
        const geo = new THREE.BufferGeometry();
        const count = 100;
        const positions = new Float32Array(count * 3);
        const velocities = [];

        for(let i=0; i<count; i++) {
            positions[i*3] = position.x + (Math.random() - 0.5) * 0.5;
            positions[i*3+1] = position.y + (Math.random() - 0.5) * 0.5;
            positions[i*3+2] = position.z + (Math.random() - 0.5) * 0.5;
            velocities.push({
                x: (Math.random() - 0.5) * 0.3,
                y: Math.random() * 0.25,
                z: (Math.random() - 0.5) * 0.3
            });
        }

        geo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        const mat = new THREE.PointsMaterial({
            color: color,
            size: 0.15,
            transparent: true,
            opacity: 0.9,
            blending: THREE.AdditiveBlending
        });
        const ps = new THREE.Points(geo, mat);
        ps.userData = { velocities: velocities, life: 90 };
        this.scene.add(ps);
        this.particles.push(ps);
    },

    animate: function() {
        if (!this.active) return;
        this.animationId = requestAnimationFrame(this.animate.bind(this));

        const delta = this.clock.getDelta();
        const elapsed = this.clock.getElapsedTime();

        if(this.azure) {
            this.azure.rotation.y = Math.sin(elapsed * 1.2) * 0.1;
            this.azure.position.y = 0.5 + Math.sin(elapsed * 2) * 0.05;
        }

        if(this.tesseract) {
            this.tesseract.rotation.x += delta * 0.8;
            this.tesseract.rotation.y += delta * 1.2;
            this.tesseract.rotation.z += delta * 0.5;
        }

        if (this.isGlitching) {
            this.camera.position.x += (Math.random() - 0.5) * 0.3;
            this.camera.position.y += (Math.random() - 0.5) * 0.3;
            if (Math.random() > 0.8) {
                this.groundGrid.material.color.setHex(Math.random() > 0.5 ? 0xff0000 : 0x00ffff);
            }
            if (Math.random() > 0.7) {
                this.ambientLight.intensity = Math.random() * 2;
            }
        } else {
            if (this.groundGrid) {
                this.groundGrid.material.color.setHex(0x00ffff);
            }
            if (this.ambientLight) {
                this.ambientLight.intensity = 1.5;
            }
        }

        this.particles.forEach((p, index) => {
            const pos = p.geometry.attributes.position.array;
            const v = p.userData.velocities;
            for(let i=0; i<v.length; i++) {
                pos[i*3] += v[i].x;
                pos[i*3+1] += v[i].y;
                pos[i*3+2] += v[i].z;
                v[i].y -= 0.005;
            }
            p.geometry.attributes.position.needsUpdate = true;
            p.userData.life--;
            p.material.opacity = p.userData.life / 90;

            if(p.userData.life <= 0) {
                this.scene.remove(p);
                this.particles.splice(index, 1);
            }
        });

        this.renderer.render(this.scene, this.camera);
    },

    playSequence: async function() {
        this.active = true;
        this.init();
        document.getElementById('cutscene-layer').classList.remove('hidden');

        if (!AudioSystem.ctx) {
            AudioSystem.init();
        }

        AudioSystem.startMusic('ambient');

        const showText = async (text, dur = 3000) => {
            const box = document.getElementById('cs-dialog-box');
            const content = document.getElementById('cs-dialog-text');
            content.innerHTML = text;
            box.style.opacity = 1;
            await this.sleep(dur);
            box.style.opacity = 0;
            await this.sleep(500);
        };

        const moveDialogAway = () => {
            const box = document.getElementById('cs-dialog-box');
            if (box) box.classList.add('cs-move-up');
        };
        const moveDialogBack = () => {
            const box = document.getElementById('cs-dialog-box');
            if (box) box.classList.remove('cs-move-up');
        };

        await this.sleep(1000);

        AudioSystem.playSFX('whoosh');
        const camStartPos = { x: 0, y: 5, z: 10 };
        let t = 0;
        while(t < 1) {
            t += 0.008;
            this.camera.position.x = camStartPos.x + Math.sin(t * Math.PI) * 1.5;
            this.camera.lookAt(0, 0, 0);
            await this.sleep(16);
        }

        await showText("System: Sector Zero. Hub World. Status: Normal.", 3000);

        AudioSystem.playSFX('tension');
        AudioSystem.fadeMusic(0.1, 1);

        this.scene.fog.color.setHex(0x330000);
        this.scene.background.setHex(0x110000);
        this.ambientLight.color.setHex(0x400000);
        this.rimLight.color.setHex(0xff0000);

        const camZoomStart = this.camera.position.clone();
        t = 0;
        while(t < 1) {
            t += 0.03;
            this.camera.position.z = camZoomStart.z - t * 2;
            this.camera.position.y = camZoomStart.y + t * 1;
            this.camera.lookAt(0, 2, -5);
            await this.sleep(16);
        }

        AudioSystem.playSFX('alert');
        document.getElementById('game-wrapper').classList.add('screen-shake');
        await showText("System Alert: Anomalous energy signature detected!", 2000);

        AudioSystem.stopMusic();
        await this.sleep(300);
        AudioSystem.startMusic('danger');

        this.createTesseract();
        AudioSystem.playSFX('whoosh');
        moveDialogAway();

        t = 0;
        while(t < 1) {
            t += 0.01;
            const easeT = t * t;
            this.tesseract.position.y = 20 + (5 - 20) * easeT;
            this.camera.lookAt(0, this.tesseract.position.y * 0.3, -5);
            await this.sleep(16);
        }

        AudioSystem.playSFX('explosion');
        document.getElementById('game-wrapper').classList.remove('screen-shake');
        await this.sleep(300);
        moveDialogBack();

        this.isGlitching = true;
        const warn = document.getElementById('warning-overlay');
        warn.style.display = 'block';
        warn.classList.add('glitch-anim');

        for(let i = 0; i < 5; i++) {
            AudioSystem.playSFX('glitch');
            await this.sleep(300);
        }

        await this.sleep(0);
        warn.style.display = 'none';

        await showText("Entity: Crimson Tesseract. executing: DELETE_ALL.EXE", 3000);

        AudioSystem.playSFX('whoosh');
        const startG = this.greenCube.position.clone();
        const startY = this.yellowCube.position.clone();
        t = 0;
        while(t < 1) {
            t += 0.01;
            this.greenCube.position.lerpVectors(startG, this.tesseract.position, t);
            this.yellowCube.position.lerpVectors(startY, this.tesseract.position, t);
            const s = 1 - t;
            this.greenCube.scale.set(s, s, 0.1);
            this.yellowCube.scale.set(s, s, 0.1);
            await this.sleep(16);
        }

        AudioSystem.playSFX('damage');
        this.scene.remove(this.greenCube);
        this.scene.remove(this.yellowCube);
        this.createDeResParticles(this.tesseract.position, 0x00ff00);
        this.createDeResParticles(this.tesseract.position, 0xffff00);

        await showText("Azure: NO! They're being compressed!", 2000);

        AudioSystem.playSFX('explosion');
        AudioSystem.playSFX('damage');
        this.createDeResParticles(this.azure.position, 0x00ffff);
        const azStart = this.azure.position.clone();
        const azEnd = new THREE.Vector3(0, 0.5, 8);
        const camDamageStart = this.camera.position.clone();

        t = 0;
        while(t < 1) {
            t += 0.02;
            this.azure.position.lerpVectors(azStart, azEnd, t);
            this.azure.rotation.z += 0.2;
            this.azure.material.color.setHex(Math.random() > 0.5 ? 0x333333 : 0x00ffff);
            this.azure.material.emissiveIntensity = Math.random() * 0.8;

            this.camera.position.z = camDamageStart.z + Math.sin(t * Math.PI * 4) * 0.5;
            this.camera.lookAt(this.azure.position);

            if (t % 0.1 < 0.02) AudioSystem.playSFX('glitch');

            await this.sleep(16);
        }

        await showText("System: CORE INTEGRITY CRITICAL. ABILITIES OFFLINE.", 2000);

        AudioSystem.playSFX('whoosh');
        while(this.azure.position.x > -15) {
            this.azure.position.x -= 0.5;
            this.camera.position.x -= 0.2;
            this.camera.lookAt(this.azure.position);
            await this.sleep(16);
        }

        AudioSystem.fadeMusic(0, 1.5);
        await this.sleep(500);
        this.cleanup();
    },

    cleanup: function() {
        this.active = false;
        cancelAnimationFrame(this.animationId);
        document.getElementById('cutscene-layer').classList.add('hidden');
        AudioSystem.stopMusic();
        startGame();
    },

    sleep: function(ms) { return new Promise(r => setTimeout(r, ms)); }
};

// --- CAMPAIGN DATA ---
const CAMPAIGN_DATA = {
    act1: {
        title: "The Glitch",
        levels: [
            {
                id: "level_1_tutorial",
                scene: "Sector Zero (Ruins)",
                introDialogue: [
                    { speaker: "Azure", text: "Ugh... my render buffer... hurts." },
                    { speaker: "System", text: "DIAGNOSTIC: Friends deleted. World corrupted. Jump module online." },
                    { speaker: "Azure", text: "I have to get them back. I have to find that red box." }
                ],
                bg: "#111",
                floorColor: "#003366"
            }
        ]
    }
};

// --- 2D GAME ENGINE ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const WIDTH = 800;
const HEIGHT = 600;

const GAME_STATE = { MENU: 0, DIALOGUE: 1, COMBAT: 2 };
let currentState = GAME_STATE.MENU;
let keys = {};

window.addEventListener('keydown', e => {
    keys[e.code] = true;
    if (StoryManager.active && e.code === 'Space') {
        e.preventDefault();
        StoryManager.advance();
    }
});
window.addEventListener('keyup', e => keys[e.code] = false);

const StoryManager = {
    active: false, queue: [], currentLineIndex: 0,
    container: document.getElementById('dialogue-box'),
    speakerEl: document.getElementById('speaker-name'),
    textEl: document.getElementById('dialogue-text'),

    startDialogue: function (dialogueArray) {
        this.queue = dialogueArray;
        this.currentLineIndex = 0;
        this.active = true;
        currentState = GAME_STATE.DIALOGUE;
        this.container.classList.remove('hidden');
        this.showLine();
    },
    showLine: function () {
        if (this.currentLineIndex >= this.queue.length) {
            this.endDialogue();
            return;
        }
        const line = this.queue[this.currentLineIndex];
        this.speakerEl.innerText = line.speaker;
        this.textEl.innerText = line.text;
    },
    advance: function () { this.currentLineIndex++; this.showLine(); },
    endDialogue: function () {
        this.active = false;
        this.container.classList.add('hidden');
        currentState = GAME_STATE.COMBAT;
    }
};

class Entity {
    constructor(x, y, color) {
        this.x = x; this.y = y; this.w = 50; this.h = 50;
        this.color = color; this.vx = 0; this.vy = 0; this.isGrounded = false;
    }
    update() {
        this.vy += 0.6; this.x += this.vx; this.y += this.vy;
        this.vx *= 0.8;
        if (this.y + this.h >= HEIGHT - 50) {
            this.y = HEIGHT - 50 - this.h; this.vy = 0; this.isGrounded = true;
        } else { this.isGrounded = false; }
        if (this.x < 0) this.x = 0;
        if (this.x + this.w > WIDTH) this.x = WIDTH - this.w;
    }
    draw() {
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.w, this.h);
        if (this === player) {
            ctx.shadowBlur = 10; ctx.shadowColor = this.color;
            ctx.strokeStyle = "white"; ctx.strokeRect(this.x, this.y, this.w, this.h);
            ctx.shadowBlur = 0;
        }
    }
}

class Player extends Entity {
    constructor() { super(100, HEIGHT - 150, '#0000FF'); }
    update() {
        if (currentState !== GAME_STATE.COMBAT) return;
        super.update();
        if (keys['ArrowLeft'] || keys['KeyA']) this.vx -= 1.0;
        if (keys['ArrowRight'] || keys['KeyD']) this.vx += 1.0;
        if ((keys['ArrowUp'] || keys['KeyW'] || keys['Space']) && this.isGrounded) this.vy = -14;
    }
}

let player = new Player();

function loop() {
    ctx.fillStyle = '#111'; ctx.fillRect(0, 0, WIDTH, HEIGHT);
    ctx.fillStyle = '#003366'; ctx.fillRect(0, HEIGHT - 50, WIDTH, 50);
    player.update();
    player.draw();
    requestAnimationFrame(loop);
}

// --- FLOW CONTROL ---
function startCampaignFlow() {
    document.getElementById('main-menu').classList.remove('active');
    document.getElementById('main-menu').classList.add('hidden');
    Cutscene3D.playSequence();
}

function startGame() {
    const level = CAMPAIGN_DATA.act1.levels[0];
    player.x = 100; player.y = HEIGHT - 150;
    StoryManager.startDialogue(level.introDialogue);

    if (!gameLoopStarted) {
        gameLoopStarted = true;
        loop();
    }
}

function showCredits() {
    alert("Placeholder for Credits Screen.");
}

let gameLoopStarted = false;
ctx.fillStyle = '#111'; ctx.fillRect(0, 0, WIDTH, HEIGHT);
    </script>


<protonpass-root-e785 data-protonpass-role="root" data-protonpass-theme="os"><template shadowrootmode="closed"></template></protonpass-root-e785></body></html>